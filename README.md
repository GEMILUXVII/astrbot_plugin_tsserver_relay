<div align="center">
  <img src="LOGO.png" alt="AstrBot TeamSpeak Plugin Logo" width="160" />
</div>

# <div align="center">TeamSpeak Relay</div>

<div align="center">
  <strong>AstrBot TeamSpeak 3 æœåŠ¡å™¨ç›‘æ§é€šçŸ¥æ’ä»¶</strong>
</div>

<br>

<div align="center">
  <a href="CHANGELOG.md"><img src="https://img.shields.io/badge/version-v1.0.3-9644F4?style=for-the-badge" alt="Version"></a>
  <a href="https://github.com/GEMILUXVII/astrbot_plugin_tsserver_relay/blob/master/LICENSE"><img src="https://img.shields.io/badge/license-AGPL--3.0-E53935?style=for-the-badge" alt="License"></a>
  <a href="https://www.python.org/downloads/"><img src="https://img.shields.io/badge/Python-3.10+-3776AB?style=for-the-badge&logo=python&logoColor=white" alt="Python"></a>
  <a href="https://github.com/AstrBotDevs/AstrBot"><img src="https://img.shields.io/badge/AstrBot-Compatible-00BFA5?style=for-the-badge&logo=robot&logoColor=white" alt="AstrBot Compatible"></a>
</div>

<div align="center">
  <a href="https://teamspeak.com/"><img src="https://img.shields.io/badge/TeamSpeak-Server-2580C3?style=for-the-badge&logo=teamspeak&logoColor=white" alt="TeamSpeak"></a>
  <a href="https://github.com/NapNeko/NapCatQQ"><img src="https://img.shields.io/badge/NapCat-QQ-2196F3?style=for-the-badge&logo=qq&logoColor=white" alt="NapCat"></a>
</div>

<br>

<div align="center">
  <a href="#æ’ä»¶ç®€ä»‹">æ’ä»¶ç®€ä»‹</a> â€¢
  <a href="#åŠŸèƒ½ç‰¹æ€§">åŠŸèƒ½ç‰¹æ€§</a> â€¢
  <a href="#å‘½ä»¤åˆ—è¡¨">å‘½ä»¤åˆ—è¡¨</a> â€¢
  <a href="#ä½¿ç”¨ç¤ºä¾‹">ä½¿ç”¨ç¤ºä¾‹</a> â€¢
  <a href="CHANGELOG.md">æ›´æ–°æ—¥å¿—</a>
</div>

## æ’ä»¶ç®€ä»‹

AstrBot TeamSpeak 3 æœåŠ¡å™¨ç›‘æ§æ’ä»¶ï¼Œæ”¯æŒå¤šæœåŠ¡å™¨ç›‘æ§ã€ç”¨æˆ·è¿›å‡ºé€šçŸ¥ã€å®šæ—¶çŠ¶æ€æ¨é€ã€è®¢é˜…ç®¡ç†ç­‰åŠŸèƒ½ã€‚

## åŠŸèƒ½ç‰¹æ€§

- **å¤šæœåŠ¡å™¨ç›‘æ§**ï¼šåŒæ—¶ç›‘æ§å¤šä¸ª TS3 æœåŠ¡å™¨ï¼Œæ”¯æŒå¤šå¼€å®ä¾‹
- **å®æ—¶è¿›å‡ºé€šçŸ¥**ï¼šç”¨æˆ·åŠ å…¥/ç¦»å¼€æœåŠ¡å™¨æ—¶è‡ªåŠ¨æ¨é€é€šçŸ¥
- **å®šæ—¶çŠ¶æ€æ¨é€**ï¼šå¯é…ç½®é—´éš”ï¼ˆé»˜è®¤ 60 åˆ†é’Ÿï¼‰è‡ªåŠ¨æ¨é€æœåŠ¡å™¨çŠ¶æ€
- **è®¢é˜…æ¨é€**ï¼šç”¨æˆ·å¯è‡ªä¸»è®¢é˜…/å–æ¶ˆè®¢é˜…ï¼Œç²¾å‡†æ¨é€åˆ°ç¾¤/ç§èŠ
- **@å…¨ä½“æˆå‘˜**ï¼šæ”¯æŒçŠ¶æ€æ¨é€æ—¶è‡ªåŠ¨ @å…¨ä½“æˆå‘˜ï¼ˆå¯é€‰ï¼‰
- **æŠ—æŠ–åŠ¨æœºåˆ¶**ï¼šå†…ç½® 5 ç§’ç¡®è®¤æœŸï¼Œé¿å…ç½‘ç»œæŠ–åŠ¨å¯¼è‡´çš„è¯¯æŠ¥
- **æ•°æ®æŒä¹…åŒ–**ï¼šç›‘æ§ä¸è®¢é˜…æ•°æ®è‡ªåŠ¨ä¿å­˜ï¼Œé‡å¯ä¸ä¸¢å¤±
- **æƒé™æ§åˆ¶**ï¼šæ·»åŠ /åˆ é™¤æœåŠ¡å™¨éœ€ç®¡ç†å‘˜æƒé™
- **çŠ¶æ€æŸ¥è¯¢**ï¼šéšæ—¶æŸ¥çœ‹æœåŠ¡å™¨å®æ—¶çŠ¶æ€

## æ’ä»¶å®‰è£…

1. **å®‰è£…ä¾èµ–**

   ```bash
   pip install ts3
   ```

2. **å®‰è£…æ’ä»¶**

   å°†æœ¬æ’ä»¶ç›®å½•æ”¾å…¥ AstrBot çš„ `data/plugins/` ç›®å½•ä¸‹ï¼š

   ```
   data/plugins/astrbot_plugin_tsserver_relay/
   â”œâ”€â”€ main.py
   â”œâ”€â”€ metadata.yaml
   â”œâ”€â”€ requirements.txt
   â”œâ”€â”€ core/
   â”œâ”€â”€ models/
   â”œâ”€â”€ storage/
   â””â”€â”€ utils/
   ```

3. **é‡å¯/é‡è½½ AstrBot**

   åœ¨ WebUI é‡è½½æ’ä»¶ï¼Œæˆ–ç›´æ¥é‡å¯ AstrBotã€‚

## é…ç½® TeamSpeak é˜²æ´ªç™½åå•

> [!WARNING]
> **é‡è¦ï¼šé…ç½® ServerQuery ç™½åå•**
>
> æœ¬æ’ä»¶ä¼šä»¥è¾ƒé«˜çš„é¢‘ç‡ä¸ TeamSpeak æœåŠ¡å™¨çš„ ServerQuery ç«¯å£é€šä¿¡ã€‚ä¸ºé˜²æ­¢è¢« TeamSpeak çš„é˜²æ´ªï¼ˆAnti-Floodï¼‰æœºåˆ¶è¯¯åˆ¤ä¸ºæ”»å‡»ï¼Œ**å¿…é¡»**å°†ç®¡ç†å·¥å…·çš„ IP åœ°å€åŠ å…¥æœåŠ¡å™¨çš„ç™½åå•ã€‚

è¿›å…¥æ¯ä¸ª TeamSpeak æœåŠ¡å™¨çš„æ•°æ®ç›®å½•ï¼Œåˆ›å»ºæˆ–ç¼–è¾‘ `query_ip_allowlist.txt` æ–‡ä»¶ï¼š

```
127.0.0.1
::1
172.16.0.0/12  # è¦†ç›– Docker é»˜è®¤çš„å†…éƒ¨ç½‘ç»œåœ°å€èŒƒå›´
```

> [!CAUTION]
> **å¿…é¡»é‡å¯ TeamSpeak æœåŠ¡ï¼**
>
> è¿™æ˜¯æœ€å®¹æ˜“è¢«å¿½ç•¥ä½†è‡³å…³é‡è¦çš„ä¸€æ­¥ã€‚ç™½åå•é…ç½®å¿…é¡»åœ¨é‡å¯åæ‰èƒ½ç”Ÿæ•ˆã€‚

```bash
# è¿›å…¥ TeamSpeak é¡¹ç›®ç›®å½•
cd /path/to/your/teamspeak_project
docker-compose restart
```

## å‘½ä»¤åˆ—è¡¨

### ç®¡ç†å‘˜å‘½ä»¤

| å‘½ä»¤                                                          | è¯´æ˜              | ç¤ºä¾‹                                             |
| ------------------------------------------------------------- | ----------------- | ------------------------------------------------ |
| `/ts add <åˆ«å> <ä¸»æœº> <ç”¨æˆ·å> <å¯†ç > [ç«¯å£] [è™šæ‹ŸæœåŠ¡å™¨ID]` | æ·»åŠ æœåŠ¡å™¨        | `/ts add myts 192.168.1.100 serveradmin pass123` |
| `/ts del <åˆ«å>`                                              | åˆ é™¤æœåŠ¡å™¨        | `/ts del myts`                                   |
| `/ts join <åˆ«å> [on/off]`                                    | åˆ‡æ¢åŠ å…¥é€šçŸ¥      | `/ts join myts off`                              |
| `/ts leave <åˆ«å> [on/off]`                                   | åˆ‡æ¢ç¦»å¼€é€šçŸ¥      | `/ts leave myts on`                              |
| `/ts interval <åˆ«å> <åˆ†é’Ÿ>`                                  | è®¾ç½®çŠ¶æ€æ¨é€é—´éš”  | `/ts interval myts 30`                           |
| `/ts atall <åˆ«å> [on/off]`                                   | è®¾ç½®çŠ¶æ€æ¨é€@å…¨ä½“ | `/ts atall myts on`                              |
| `/ts restart [åˆ«å]`                                          | é‡å¯ç›‘æ§          | `/ts restart myts`                               |

### æ™®é€šç”¨æˆ·å‘½ä»¤

| å‘½ä»¤                | è¯´æ˜           | ç¤ºä¾‹              |
| ------------------- | -------------- | ----------------- |
| `/ts ls`            | æŸ¥çœ‹ç›‘æ§åˆ—è¡¨   | `/ts ls`          |
| `/ts sub <åˆ«å>`    | è®¢é˜…æœåŠ¡å™¨é€šçŸ¥ | `/ts sub myts`    |
| `/ts unsub <åˆ«å>`  | å–æ¶ˆè®¢é˜…       | `/ts unsub myts`  |
| `/ts mysub`         | æŸ¥çœ‹æˆ‘çš„è®¢é˜…   | `/ts mysub`       |
| `/ts status [åˆ«å]` | æŸ¥çœ‹æœåŠ¡å™¨çŠ¶æ€ | `/ts status myts` |

## ä½¿ç”¨ç¤ºä¾‹

### æ·»åŠ æœåŠ¡å™¨ï¼ˆç®¡ç†å‘˜ï¼‰

```
/ts add myserver 192.168.1.100 serveradmin MyPassword123
```

é»˜è®¤ä½¿ç”¨ç«¯å£ 10011 å’Œè™šæ‹ŸæœåŠ¡å™¨ ID 1ã€‚å¦‚éœ€è‡ªå®šä¹‰ï¼š

```
/ts add myserver 192.168.1.100 serveradmin MyPassword123 10022 1
```

### ç”¨æˆ·è®¢é˜…

```
/ts sub myserver
```

### å…³é—­ç¦»å¼€é€šçŸ¥

```
/ts leave myserver off
```

### ä¿®æ”¹çŠ¶æ€æ¨é€é—´éš”

```
/ts interval myserver 30
```

### æŸ¥çœ‹æœåŠ¡å™¨çŠ¶æ€

```
/ts status myserver
```

## é€šçŸ¥æ ·ä¾‹

### ç”¨æˆ·åŠ å…¥é€šçŸ¥

```
ğŸ“¢ TeamSpeak ç”¨æˆ·åŠ å…¥
â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ–¥ï¸ æœåŠ¡å™¨: myserver
ğŸ‘¤ ç”¨æˆ·: PlayerName
â° æ—¶é—´: 20:30:45
â”â”â”â”â”â”â”â”â”â”â”â”â”â”
æ¬¢è¿åŠ å…¥è¯­éŸ³ï¼
```

### ç”¨æˆ·ç¦»å¼€é€šçŸ¥

```
ğŸ“¤ TeamSpeak ç”¨æˆ·ç¦»å¼€
â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ–¥ï¸ æœåŠ¡å™¨: myserver
ğŸ‘¤ ç”¨æˆ·: PlayerName
â° æ—¶é—´: 21:15:30
â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ä¸‹æ¬¡å†è§ï¼
```

### æœåŠ¡å™¨çŠ¶æ€é€šçŸ¥

```
ğŸ“Š TeamSpeak æœåŠ¡å™¨çŠ¶æ€
â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ–¥ï¸ æœåŠ¡å™¨: myserver
ğŸ“› åç§°: My Gaming Server
ğŸ‘¥ åœ¨çº¿äººæ•°: 5/32
ğŸ“ é¢‘é“æ•°: 10
â±ï¸ è¿è¡Œæ—¶é—´: 3å¤©12å°æ—¶30åˆ†é’Ÿ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ‘¤ åœ¨çº¿ç”¨æˆ·: Player1ã€Player2ã€Player3
â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ• æ›´æ–°æ—¶é—´: 2025-12-10 21:00:00
```

## æ•°æ®å­˜å‚¨

æ’ä»¶æ•°æ®é»˜è®¤å­˜å‚¨äºï¼š

```
data/plugin_data/astrbot_plugin_tsserver_relay/ts3_data.json
```

æ•°æ®ç»“æ„ç¤ºä¾‹ï¼š

```json
{
  "subscriptions": {
    "myserver": {
      "default:GroupMessage:123456789": {
        "notify_join": true,
        "notify_leave": true,
        "notify_status": true,
        "at_all": false
      }
    }
  },
  "server_info": {
    "myserver": {
      "name": "myserver",
      "host": "192.168.1.100",
      "query_port": 10011,
      "query_user": "serveradmin",
      "query_password": "password",
      "virtual_server_id": 1,
      "status_interval": 60
    }
  }
}
```

## å¸¸è§é—®é¢˜

### Q: æç¤º "ts3 åº“æœªå®‰è£…"

A: è¯·è¿è¡Œ `pip install ts3` å®‰è£…ä¾èµ–ã€‚

### Q: æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨

A: è¯·æ£€æŸ¥ï¼š

- æœåŠ¡å™¨åœ°å€å’Œ ServerQuery ç«¯å£æ˜¯å¦æ­£ç¡®ï¼ˆé»˜è®¤ 10011ï¼Œéå®¢æˆ·ç«¯ç«¯å£ 9987ï¼‰
- ServerQuery è´¦æˆ·ç”¨æˆ·åå¯†ç æ˜¯å¦æ­£ç¡®
- æœåŠ¡å™¨é˜²ç«å¢™æ˜¯å¦å…è®¸è¯¥ç«¯å£è®¿é—®

### Q: å¤šå¼€æœåŠ¡å™¨å¦‚ä½•é…ç½®

A: ä¸ºæ¯ä¸ªå®ä¾‹æŒ‡å®šä¸åŒçš„ç«¯å£ï¼š

```
/ts add server1 192.168.1.100 admin pass1 10011
/ts add server2 192.168.1.100 admin pass2 10012
```

### Q: @å…¨ä½“æˆå‘˜ ä¸ç”Ÿæ•ˆ

A: è¯·ç¡®ä¿å·²å¼€å¯ @å…¨ä½“ï¼Œä¸”æœºå™¨äººæœ‰ç¾¤ç®¡ç†å‘˜æƒé™ï¼Œç¾¤è®¾ç½®å…è®¸ @å…¨ä½“æˆå‘˜ã€‚

### Q: æ”¶ä¸åˆ°è¿›å‡ºé€šçŸ¥

A: æ£€æŸ¥ç›‘æ§çŠ¶æ€ã€è®¢é˜…çŠ¶æ€ï¼Œå¿…è¦æ—¶ä½¿ç”¨ `/ts restart` é‡å¯ç›‘æ§ã€‚

## ç›¸å…³é“¾æ¥

- [AstrBot å®˜æ–¹æ–‡æ¡£](https://astrbot.app/)
- [AstrBot æ’ä»¶å¼€å‘æŒ‡å—](https://docs.astrbot.app/dev/star/plugin-new.html)
- [TeamSpeak å®˜ç½‘](https://teamspeak.com/)
- [ts3 Python åº“](https://github.com/benediktschmitt/py-ts3)

## è®¸å¯è¯

[![](https://www.gnu.org/graphics/agplv3-155x51.png "AGPL v3 logo")](https://www.gnu.org/licenses/agpl-3.0.txt)

Copyright (C) 2025 GEMILUXVII

This program is free software: you can redistribute it and/or modify it under the terms of the GNU Affero General Public License as published by the Free Software Foundation, either version 3 of the License, or any later version.

This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero General Public License for more details.

You should have received a copy of the GNU Affero General Public License along with this program. If not, see <https://www.gnu.org/licenses/>.
